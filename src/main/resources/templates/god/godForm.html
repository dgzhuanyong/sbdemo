<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8">
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" th:href="@{/layuiAdmin/layui/css/layui.css}" media="all">
	<link rel="stylesheet" th:href="@{/layuiAdmin/css/admin-reset.css}" media="all">
</head>
<body>
	<form class="layui-form" id="form" commandName="obj" lay-filter="formFilter">
	
	  <div class="layui-form-item">
	    <label class="layui-form-label"><span style="color:red;">*</span>账号</label>
	    <div class="layui-input-block">
	      <input type="text" name="loginName" lay-verify="loginName"  placeholder="请输入账号" class="layui-input" th:value="${obj?.loginName }">
	    </div>
	  </div>
	  
	  <div class="layui-form-item">
	    <label class="layui-form-label">密码</label>
	    <div class="layui-input-block">
	      <input type="text"  value="初始密码为：123456" readonly="readonly"  class="layui-input">
	    </div>
	  </div>
	  
	  <div class="layui-form-item">
	    <label class="layui-form-label"><span style="color:red;">*</span>姓名</label>
	    <div class="layui-input-block">
	      <input type="text" name="name" lay-verify="name" autocomplete="off" placeholder="请输入姓名" class="layui-input" th:value="${obj?.name }">
	    </div>
	  </div>
	  
	  <div class="layui-form-item">
	    <label class="layui-form-label">状态</label>
	    <div class="layui-input-block">
	      <input type="checkbox" lay-skin="switch" th:checked="${null == obj || !obj.status}" lay-text="启用|停用" lay-filter="statusFilter">
	    </div>
	  </div>
	  
	  <!-- <div class="layui-form-item">
	    <label class="layui-form-label"><span style="color:red;">*</span>角色</label>
	    <div class="layui-input-block">
	      <select name="role" lay-verify="role">
	      	<option value="">请选择角色</option>
	      	<c:forEach items="${list }" var="obj">
	      		<option value="${obj.id}" <c:if test="${obj.id == godRole.roleId }">selected="selected"</c:if>>${obj.name }</option>
	      	</c:forEach>
	      </select>
	    </div>
	  </div> -->
	  
	  <div class="layui-form-item layui-form-text">
	    <label class="layui-form-label">唯一身份标识</label>
	    <div class="layui-input-block">
	      <textarea placeholder="请输入唯一身份标识,不超过200个字" class="layui-textarea" name="idCode" lay-verify="idCode" th:value="${obj?.idCode }"></textarea>
	    </div>
	  </div>
	  <input type="hidden" name="status" id="status" th:value="${obj?.status}">
	  <input type="hidden" name="id" th:value="${obj?.id }">
	  <button class="layui-btn" lay-submit lay-filter="submmitFilter" style="display: none;" id="sunmitbtn"></button>
	</form>
	
	<!-- JS -->
	<script th:src="@{/layuiAdmin/lib/jquery-1.11.3.min.js}"></script>
	<script th:src="@{/layuiAdmin/layui/layui.js}" charset="utf-8"></script>
	<script th:src="@{/layuiAdmin/lib/jquery-form.js}"></script>
	<script th:inline="javascript">
	//拼接url
	var basePath = /*[[${#httpServletRequest.getScheme() + "://" + #httpServletRequest.getServerName() + ":" + #httpServletRequest.getServerPort() + #httpServletRequest.getContextPath()}]]*/;
	var requestUrl;
	var obj = [[${obj}]];
	if(null == obj){
		requestUrl = basePath+'/god/insert';
	}else{
		requestUrl = basePath+'/god/update';
	}
	//返回页面的数据
	var oldLoginName = [[${obj?.loginName}]];
	//业务
	var parentIndex;
	layui.use(['form'], function(){
		  var form = layui.form
		  ,layer = layui.layer
		  //监听开关
		  form.on('switch(statusFilter)',function(data){
			  	if(data.elem.checked){
			  		$("#status").val(false);
			  	}else{
			  		$("#status").val(true);
			  	}
		  })
		  //表单验证
		  form.verify({
			  loginName: function(value, item){ //value：表单的值、item：表单的DOM对象
				value = $.trim(value);
			  	if(value.length == 0){
			  		return '登录名不能为空'
			  	}
			  	if(value.length > 20){
			  		return '登录名长度不能大于20个字'
			  	}
			    if(!new RegExp("^[a-zA-Z0-9_\u4e00-\u9fa5\\s·]+$").test(value)){
			      return '登录名不能有特殊字符'
			    }
			    var text = '';
                $.ajax({
                    url: basePath+'/god/checkRepeat',
                    type: "post",
                    async: false,
                    dataType: "json",
                    data: {oldLoginName:oldLoginName,newLoginName:value},
                    success: function (result) {
                        if (!result) {
                            text = '登录名已存在'
                        }
                    }, error: function () {
                        text = '登录名已存在'
                    }
                });
                return text;
			  },
			  name: function(value, item){ //value：表单的值、item：表单的DOM对象
				value = $.trim(value);
			  	if(value.length == 0){
			  		return '姓名不能为空'
			  	}
			  	if(value.length > 20){
			  		return '姓名长度不能大于20个字'
			  	}
			    if(!new RegExp("^[a-zA-Z0-9_\u4e00-\u9fa5\\s·]+$").test(value)){
			      return '姓名不能有特殊字符'
			    }
			  },
			  idCode: function(value, item){ //value：表单的值、item：表单的DOM对象
				value = $.trim(value);
			  	if(value.length > 200){
			  		return '唯一身份标识长度不能大于200个字'
			  	}
			  }/* ,
			  role: function(value, item){ //value：表单的值、item：表单的DOM对象
				value = $.trim(value);
			  	if(value.length == 0){
			  		return '请选择角色'
			  	}
			  } */
		  });
		  //监听提交
		  form.on('submit(submmitFilter)', function(data){
			  $("#form").ajaxSubmit({
		    		url: requestUrl,
		    		type: "post",
		    		success: function(result) {
		    			var code = result.code;
		    			var type = result.type;
		    			if(code == 'success'){
		    				if(type == 'add'){
		    					layer.msg('添加成功', {
		    		    			  icon: 6
		    		    			  ,time: 1500
		    		    		});
		    				}else{
		    					layer.msg('修改成功', {
		    		    			  icon: 6
		    		    			  ,time: 1500
		    		    		});
		    				}
		    				setTimeout(function(){
		    					parent.conditionReset();
		    					parent.layer.close(parentIndex);
		    				}, 1500);
		    			}
		    		},
		    		error: function() {
		    			layer.msg('提交失败', {
			    			  icon: 5
			    			  ,time: 1500
			    		});
		    		}
		    	});
			    return false;
		  });
		  
	});
	//模拟按钮提交 
	function submitForm(index){
		parentIndex = index;
		$("#sunmitbtn").click();
	}
	</script>
</body>
</html>